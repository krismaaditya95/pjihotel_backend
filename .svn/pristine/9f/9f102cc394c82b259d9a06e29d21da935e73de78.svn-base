package com.mini.project.hotel.controller;

import java.text.ParseException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

import com.mini.project.hotel.exception.ResourceNotFoundException;

@Controller
@RequestMapping("/pjihotel")
public class KamarMvcController {
	
	@Autowired
	KamarRESTController kamarREST;
	
	@RequestMapping(value = "/available-room", method=RequestMethod.GET)
	public String showAvailableRoomPage(ModelMap model) {
		model.put("kamars", kamarREST.getAllKamar());
		return "kamar";
	}
	
	@RequestMapping(value = "/add-room", method = RequestMethod.GET)
	public String showAddRoomPage(ModelMap model) {
		model.put("tipeKamar", kamarREST.getAllTipeKamar());
		model.put("statusKamar", kamarREST.getAllStatusKamar());
		return "tambah-kamar";
	}
	
	@RequestMapping(value = "/add-room", method = RequestMethod.POST)
	public String addRoom(ModelMap model, @RequestParam String noKamar, int idType, int idStatus) {
		kamarREST.addKamar(noKamar, idType, idStatus);
		return "redirect:/pjihotel/available-room";
	}
	
	// get halaman
		@RequestMapping(value = "/edit-kamar/{id_kamar}", method=RequestMethod.GET)
		public String showEditKamarPage(ModelMap model, @PathVariable(value = "id_kamar") Integer id_kamar) throws ResourceNotFoundException {
			model.put("noKamar", kamarREST.getKamarById(id_kamar));
			model.put("tipeKamar", kamarREST.getAllTipeKamar());
			model.put("statusKamar", kamarREST.getAllStatusKamar());
			return "edit-kamar";
		}
			
		// post edit
		@RequestMapping(value = "/edit-kamar/{id_kamar}", method=RequestMethod.POST)
		public String editKamar(ModelMap model, @PathVariable(value = "id_kamar")Integer id_kamar, @RequestParam String noKamar, int idType, int idStatus) throws ResourceNotFoundException, ParseException {
			kamarREST.editKamarById(id_kamar, noKamar, idType, idStatus);
			return "redirect:/pjihotel/available-room";
		}
		
		@RequestMapping(value = "/delete-kamar/{id_kamar}", method=RequestMethod.GET)
		public String deleteKamar(ModelMap model, @PathVariable(value = "id_kamar") Integer id_kamar){
			kamarREST.deleteKamarById(id_kamar);
			return "redirect:/pjihotel/available-room";
		}
}
